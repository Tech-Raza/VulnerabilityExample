package com.example.vurneability.Compliant.CWE415;

//Double Free Example -In this Cwe we're basically freeing the space two times
public class DoubleFreeExample {
    public static void main(String[] args) {
        int[] arr = new int[5];

        // Allocate memory for the array
        long ptr = allocateMemory(arr.length * 4);

        // Copy the array to the allocated memory
        for (int i = 0; i < arr.length; i++) {
            unsafe.putInt(ptr + i * 4, arr[i]);
        }

        // Free the allocated memory
        unsafe.freeMemory(ptr);

        // Access the memory after it has been freed
        int x = unsafe.getInt(ptr);

        // Free the memory again (double free)
        unsafe.freeMemory(ptr);
    }

    // Allocate memory using the unsafe class
    private static long allocateMemory(int size) {
        sun.misc.Unsafe unsafe = sun.misc.Unsafe.getUnsafe();
        return unsafe.allocateMemory(size);
    }

    // Get the unsafe object
    private static sun.misc.Unsafe unsafe = sun.misc.Unsafe.getUnsafe();
}

